{% extends "events/base.html" %}

{% block ttitle %}{{ event.type.name }} Seating Plan{% endblock %}

{% load number %}

{% block morehead %}
<link href="/static/css/events.css" rel="stylesheet" type="text/css" media="screen">
<link href="/static/css/seating.css" rel="stylesheet" type="text/css" media="screen">

    {% if seating %}
        <script type="text/javascript" src="/static/js/seating.js"></script>
        <script type="text/javascript">
        $(document).ready(function() {
            {% for col in seating %}
                Seating.initialiseContainer($('#col{{ forloop.counter0 }}')[0]);
            {% endfor %}
            Seating.initialiseContainer($('#unassigned')[0]);
            Seating.initialiseContainer($('#unassigned_empty')[0]);
        });
        </script>
    {% endif %}
{% endblock %}

{% block content %}

{% if seating %}
    <h1>Seating plan for <a href="/events/details/{{ event.id }}/">{{ event.type.name }}</a>
        , held in <a href="{{ room.room.get_absolute_url }}">{{ room }}</a></h1>
    <p>{{ event.time_string }}</p>
    <!-- visual seating plan goes here. -->
<table class="seating">
    <tbody><tr>
        <th colspan="1"></th>
            <th colspan="4"></th>
            <th colspan="2">Doors</th>

    </tr><tr>
        <th colspan="1">Unassigned</th>
        {% for col in seating %}
            {% if forloop.counter0|divisibleby:"2" %}
                <th colspan="2">Table {{ forloop.counter0|tableno }}</th>
            {% endif %}
        {% endfor %}
    </tr><tr>
    <td>
        <ul id="unassigned_empty" class="seating">
            <li class="empty">(empty)</li>
        </ul>
        <ul id="unassigned" class="seating">
        {% for user in unassigned %}
            {% if user %}
                <li id="{{ user.id }}"
                    title="{{ user.member.all_name }}">
                    {{ user.member.name }}</li>
            {% endif %}
        {% endfor %}
        </ul>
    </td>
    
    {% for col in seating %}
    <td>
    <ul id="col{{ forloop.counter0 }}" class="seating seating{{forloop.counter0|colside}}">
        {% for user in col %}
            {% if user %}
                <li id="{{ user.id }}"
                    title="{{ user.member.all_name }}">
                    {{ user.member.name }}</li>
            {% else %}
                <li class="empty">(empty)</li>
            {% endif %}
        {% endfor %}
    </ul>
    </td>
    {% endfor %}
    </tr>
    </tbody>
</table>

    <br />
    <hr />
    <br />
    <div id="comments">
    <table>
    <tbody>
        <tr>
            <th>Revision</th>
            <th>Creator</th>
            <th>Comment</th>
        </tr>
    {% if user.is_authenticated %}
    {% if notclosed %}
        <tr>
        <td>{{ new_revision_no }} (new)</td>
        <td>{{ user.username }}</td>
        <td>
            <form action="" method="post">
                  <input class="submit" type="submit" value="Save" title="Save New Revision" />
                  <input type="text" name="comment" maxlength="255" size="50" />
                  <input type="hidden" name="order" id="order" value="" />
            </form>
        </td>
        </tr>
    {% endif %}
    {% endif %}

    {% for revision in seating_revisions %}
        <tr>
        <td><a href="/events/seating/{{ event.id }}/{{ revision.number }}">{{ revision.number }}</a></td>
        <td>{{ revision.creator }}</td>
        <td>{{ revision.comment }}</td>
        </tr>
    {% endfor %}
    </tbody>
    </table>
    </div>
{% else %}
    <p>No seating plan available for {{ event.type.name }}, {{ event.start }}</p>
{% endif %}

{% endblock %}
