{% extends "events/base.html" %}

{% load number %}

{% block morehead %}
<link href="/static/css/events.css" rel="stylesheet" type="text/css" media="screen">
<link href="/static/css/seating.css" rel="stylesheet" type="text/css" media="screen">

    {% if seating %}
    <script type="text/javascript" src="/static/js/seating.js"></script>
        <script type="text/javascript">
    function doSetupCrap(le)
    {
        Seating.initialiseContainer(le);
    }

    window.onload = function()
    {
    {% for col in seating %}
        doSetupCrap(document.getElementById("col{{ forloop.counter0 }}"));
    {% endfor %}
        doSetupCrap(document.getElementById("unassigned"));
        doSetupCrap(document.getElementById("unassigned_empty"));
    };
    </script>

    {% endif %}
{% endblock %}

{% block content %}

{% if seating %}
    <h1>Seating plan for <a href="/events/details/{{ event.id }}/">{{ event.type.name }}</a>
        , held in {{ room }}</h1>
    <p>{{ event.time_string }}</p>
    <!-- visual seating plan goes here. -->
<table class="seating">
    <tbody><tr>
        <th colspan="1"></th>
            <th colspan="4"></th>
            <th colspan="2">Doors</th>

    </tr><tr>
        <th colspan="1">Unassigned</th>
        <th colspan="2">Table 1</th>
        <th colspan="2">Table 2</th>
        <th colspan="2">Table 3</th>
    </tr><tr>
    <td>
        <ul id="unassigned_empty" class="seating">
            <li class="empty">(empty)</li>
        </ul>
        <ul id="unassigned" class="seating">
        {% for user in unassigned %}
            {% if user %}
                <li id="{{ user.id }}"
                    title="{{ user.member.all_name }}">
                    {{ user.member.name }}</li>
            {% endif %}
        {% endfor %}
        </ul>
    </td>
    
    {% for col in seating %}
    <td>
    <ul id="col{{ forloop.counter0 }}" class="seating seating{{forloop.counter0|colside}}">
        {% for user in col %}
            {% if user %}
                <li id="{{ user.id }}"
                    title="{{ user.member.all_name }}">
                    {{ user.member.name }}</li>
            {% else %}
                <li class="empty">(empty)</li>
            {% endif %}
        {% endfor %}
    </ul>
    </td>
    {% endfor %}
    </tr>
    </tbody>
</table>

    <br />
    <hr />
    <br />
    <div id="comments">
    <table>
    <tbody>
        <tr>
            <th>Revision</th>
            <th>Creator</th>
            <th>Comment</th>
        </tr>
    {% if user.is_authenticated %}
        <tr>
        <td>{{ new_revision_no }} (new)</td>
        <td>{{ user.username }}</td>
        <td>
            <form action="" method="post">
                  <input class="submit" type="submit" value="Save" title="Save New Revision" />
                  <input type="text" name="comment" maxlength="255" size="50" />
                  <input type="hidden" name="order" id="order" value="" />
            </form>
        </td>
        </tr>
    {% endif %}

    {% for revision in seating_revisions %}
        <tr>
        <td><a href="/events/seating/{{ event.id }}/{{ revision.number }}">{{ revision.number }}</a></td>
        <td>{{ revision.creator }}</td>
        <td>{{ revision.comment }}</td>
        </tr>
    {% endfor %}
    </tbody>
    </table>
    </div>
{% else %}
    <p>No seating plan available for {{ event.type.name }}, {{ event.start }}</p>
{% endif %}

{% endblock %}
